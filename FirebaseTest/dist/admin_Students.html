<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Students</title>
    <style>
        bodybody {
  font-family: Arial, sans-serif;
  margin: 20px;
  background-color: #f4f4f4;
}

h1, h2 {
  color: #333;
}

form {
  background: white;
  padding: 20px;
  border-radius: 5px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  margin-bottom: 20px;
}

select, input[type="text"], input[type="checkbox"], input[type="number"] {
  margin: 10px 0;
  font-size: 16px;
  padding: 10px;
  width: 100%;
  border: 1px solid #ccc;
  border-radius: 4px;
}

button {
  padding: 10px 20px;
  font-size: 16px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  width: 100%;
}

button:hover {
  background-color: #45a049;
}

.subjects-container {
  display: flex;
  justify-content: space-between;
  margin: 10px 0;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  background: #fafafa;
}

.checkbox-container {
  display: flex;
  flex-direction: column;
  margin: 10px;
  width: 100%;
}

.checkbox-item {
  display: flex;
  align-items: center;
  margin: 5px 0;
  padding: 5px 0;
}

input[type="checkbox"] {
  width: 20px;
  height: 20px;
  margin-right: 10px;
  cursor: pointer;
}

@media (max-width: 600px) {
  .checkbox-container {
    width: 100%;
  }
}

.subject-list {
  flex: 1;
  margin: 0 10px;
}

.flex-container {
  display: flex;
  justify-content: space-between;
}

.subject-column {
  flex: 1;
  margin-right: 20px;
}

.subject-column:last-child {
  margin-right: 0;
}

.academic-year-container {
  display: flex;
  justify-content: space-between;
  margin: 10px 0;
}

.academic-year-input {
  width: 45%;
}
    </style>

    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC-K6Hfx5jrTvnilwha29ceKov0PC2kII0",
            authDomain: "pre-advisingdb.firebaseapp.com",
            projectId: "pre-advisingdb",
            storageBucket: "pre-advisingdb.appspot.com",
            messagingSenderId: "879799797410",
            appId: "1:879799797410:web:9a52fbf15ce59b8bda39fb",
            measurementId: "G-MSMWJ52KBW"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

     // Load courses from Firestore and populate the dropdown
async function loadCourses() {
  const courseDropdown = document.getElementById('student-course');
  courseDropdown.innerHTML = '<option value="" disabled selected>Select a course</option>';
  
  db.collection('Curriculum').get().then(snapshot => {
    snapshot.forEach(doc => {
      const option = document.createElement('option');
      option.text = doc.data().curriculumCourse;
      option.value = doc.id;
      courseDropdown.add(option);
    });
  }).catch(error => console.error("Error loading courses: ", error));
}

// Load curriculum for selected course
async function loadCurriculum() {
  const course = document.getElementById('student-course').value;
  const curriculumDropdown = document.getElementById('student-curriculum');
  curriculumDropdown.innerHTML = '<option value="" disabled selected>Select a curriculum</option>';
  
  db.collection('Curriculum').doc(course).get().then(doc => {
    if (doc.exists) {
      const curriculumName = doc.data().curriculumName;
      const option = document.createElement('option');
      option.text = curriculumName;
      option.value = curriculumName;
      curriculumDropdown.add(option);
    }
  }).catch(error => console.error("Error loading curriculum: ", error));
}

// Add Student Function
async function addStudent(event) {
  event.preventDefault();
  console.log("Adding student...");
  const course = document.getElementById('student-course').value;
  const curriculum = document.getElementById('student-curriculum').value;
  const studentId = document.getElementById('student-id').value;
  const name = document.getElementById('student-name').value;
  const status = document.getElementById('student-status').value;
  const year = document.getElementById('student-year').value;
  const academicYearStart = document.getElementById('academic-year-start').value;
  const academicYearEnd = document.getElementById('academic-year-end').value;

  const studentRef = db.collection('curriculum').doc(course).collection('students').doc(studentId);
  const studentDoc = await studentRef.get();

  if (studentDoc.exists) {
    const existingStudent = studentDoc.data();
    const confirmMessage = `The Student ID ${studentId} already exists.\n\nDetails:\n- Name: ${existingStudent.name}\n- Course: ${course}\n- Curriculum: ${curriculum}\n- Year Level: ${existingStudent.year}\n- Status: ${existingStudent.status}\n- Academic Year: ${existingStudent.academicYearStart}-${existingStudent.academicYearEnd}\n\nDo you want to update this student's information?`;

    if (!confirm(confirmMessage)) {
      document.getElementById('add-student-form').reset();
      return;
    }
  }

  if (!confirm(`Are you sure you want to add the student with ID: ${studentId}?`)) {
    return;
  }

  // Add or update the student
  studentRef.set({
    name: name,
    course: course,
    curriculum: curriculum,
    status: status,
    year: year,
    academicYearStart: academicYearStart,
    academicYearEnd: academicYearEnd,
  })
  .then(() => {
    console.log("Student added/updated successfully!");
    alert("Student added/updated successfully!");
    document.getElementById('add-student-form').reset();
  })
  .catch(error => console.error("Error adding/updating student: ", error));
}

// Load event listeners
window.onload = function() {
  console.log("Window loaded. Initializing...");
  loadCourses();
  document.getElementById('student-course').addEventListener('change', loadCurriculum);
  document.getElementById('add-student-form').addEventListener('submit', addStudent);
}
    </script>
</head>
<body>
    <h1>Admin Panel for Students</h1>

    <form id="add-student-form" onsubmit="addStudent(); return false;">
      <h2>Student Module</h2>
      
      <label for="student-course">Course:</label>
      <select id="student-course" required></select>
      
      <label for="student-curriculum">Curriculum:</label>
      <select id="student-curriculum" required></select>
      
      <label for="student-id">Student ID:</label>
      <input type="text" id="student-id" required>
      
      <label for="student-name">Name (Last Name, First Name, Middle Name):</label>
      <input type="text" id="student-name" required>
      
      <label for="student-status">Status:</label>
      <select id="student-status" required>
        <option value="Regular">Regular</option>
        <option value="Irregular">Irregular</option>
      </select>
      
      <label for="student-year">Year Level:</label>
      <select id="student-year" required>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
      
      <div class="academic-year-container">
        <label for="academic-year-start">Academic Year (Start):</label>
        <input type="number" id="academic-year-start" class="academic-year-input" required>
        
        <label for="academic-year-end">Academic Year (End):</label>
        <input type="number" id="academic-year-end" class="academic-year-input" required>
      </div>
      
      <button type="submit">Add Student</button>
    </form>

    
</body>
</html>
